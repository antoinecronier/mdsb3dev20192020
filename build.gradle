/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.3/userguide/tutorial_java_projects.html
 */

plugins {
    // Apply the java plugin to add support for Java
    id 'java'

    // Apply the application plugin to add support for building a CLI application.
    id 'application'

    id 'eclipse'

    id 'jacoco'

    id 'checkstyle'

    id "com.github.spotbugs" version "3.0.0"

    id 'pmd'

    id 'de.aaschmid.cpd' version '3.1'

    id "se.bjurr.violations.violations-gradle-plugin" version "1.40"
}

repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

dependencies {
    // This dependency is used by the application.
    implementation 'com.google.guava:guava:28.2-jre'

    // Use JUnit Jupiter API for testing.
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.6.0'

    // Use JUnit Jupiter Engine for testing.
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.6.0'
}

application {
    // Define the main class for the application.
    mainClassName = 'com.tactfactory.mdsb3dev20192020.App'
}

test {
    // Use junit platform for unit tests
    useJUnitPlatform()
}

task checkstyleMain (type: Checkstyle, overwrite: true) {
    ignoreFailures = true
    showViolations = false
}

task checkstyleTest (type: Checkstyle, overwrite: true){
    ignoreFailures = true
    showViolations = false
}

tasks.withType(com.github.spotbugs.SpotBugsTask) {
  ignoreFailures = true
}

task pmdMain(type: Pmd, overwrite: true) {
  ignoreFailures = true
}

task pmdTest(type: Pmd, overwrite: true) {
  ignoreFailures = true
}

cpdCheck {
  reports {
    text.enabled = true
    xml.enabled = true
  }
  source = sourceSets.main.allJava
  minimumTokenCount = 50
}

test {
  useJUnitPlatform()
  ignoreFailures = true
  reports {
    junitXml.enabled = false
    html.enabled = true
  }
}

task violations(type: se.bjurr.violations.gradle.plugin.ViolationsTask) {
   //
   // Optional config
   //
   maxReporterColumnWidth = 0 // 0 means "no limit"
   maxRuleColumnWidth = 60
   maxSeverityColumnWidth = 0
   maxLineColumnWidth = 0
   maxMessageColumnWidth = 50
   codeClimateFile = file('code-climate-file.json') // Will create a CodeClimate JSON report.
   violationsFile = file('violations-file.json') // Will create a normalized JSON report.


   //
   // Global configuration, remove if you dont want to report violations for
   // the entire repo.
   //
   minSeverity = 'INFO' // INFO, WARN or ERROR
   detailLevel = 'VERBOSE' // PER_FILE_COMPACT, COMPACT or VERBOSE
   maxViolations = 99999999 // Will fail the build if total number of found violations is higher
   printViolations = true // Will print violations found in diff


   //
   // Diff configuration, remove if you dont want to report violations for
   // files changed between specific revisions.
   //
   // diff-properties can be supplied with something like:
   //
   // ./gradlew violations -PdiffFrom=e4de20e -PdiffTo=HEAD
   //
   // And in Travis, you could add:
   //
   //  script:
   //   - 'if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then bash ./gradlew check -PdiffFrom=$TRAVIS_PULL_REQUEST_BRANCH -PdiffTo=$TRAVIS_BRANCH ; fi'
   //
   diffFrom = project.properties.diffFrom // Can be empty (ignored), Git-commit or any Git-reference
   diffTo = project.properties.diffTo // Same as above
   diffMinSeverity = 'INFO' // INFO, WARN or ERROR
   diffDetailLevel = 'VERBOSE' // PER_FILE_COMPACT, COMPACT or VERBOSE
   diffMaxViolations = 99 // Will fail the build if number of violations, in the diff within from/to, is higher
   diffPrintViolations = true // Will print violations found in diff
   gitRepo = file('.') // Where to look for Git


   //
   // This is mandatory regardless of if you want to report violations between
   // revisions or the entire repo.
   //
   // Many more formats available, see: https://github.com/tomasbjerre/violations-lib
   violations = [
      ["FINDBUGS",   projectDir.path + "/build/reports/", ".*/findbugs/.*\\.xml\$",   "Findbugs"],
      ["PMD",        projectDir.path + "/build/reports/", ".*/pmd/.*\\.xml\$",        "PMD"],
      ["CHECKSTYLE", projectDir.path + "/build/reports/", ".*/checkstyle/.*\\.xml\$", "Checkstyle"],
      ["CPD", projectDir.path + "/build/reports/", ".*/cpd/.*\\.xml\$", "Cpd"],
   ]
}

check.finalizedBy violations
